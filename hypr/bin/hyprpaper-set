#!/bin/sh

image_path=$(pwd)/$1


if [ ! -f "$image_path" ]; then
    echo "$image_path is not a file"
    exit 1
fi

if [ -z $(echo "$image_path" | grep -Ee "\.(jpg|jpeg|png)") ]; then
    echo "$image_path is not an image"
    exit 1
fi

old_images=$(grep -Ee "^preload=" ~/.config/hypr/hyprpaper.conf | sed "s/^preload=//g")

echo "Old wallpapers:"
for old_image in $old_images; do
    echo "- $old_image"
done

echo "New wallpaper: $image_path"

hyprctl hyprpaper preload $image_path
hyprctl hyprpaper wallpaper "eDP-1,$image_path"
# for old_image in $old_images; do
#     hyprctl hyprpaper unload $old_image
# done

cat > ~/.config/hypr/hyprpaper.conf << EOF
preload=$image_path
wallpaper=eDP-1,$image_path
EOF

EWW="eww -c $HOME/.config/hypr/eww"
$EWW reload
